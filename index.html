<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elite Flat Pro Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@200;400;500&display=swap');

        :root {
            --bg-deep: #050505;
            --accent-gold: #c5a059;
            --accent-silver: #e5e4e2;
            --border-muted: #1a1a1a;
            --surface-low: #0a0a0a;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background-color: var(--bg-deep);
            color: var(--accent-silver);
            overscroll-behavior: none;
            letter-spacing: 0.05em;
        }

        .no-select {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        /* Плавные переходы для кнопок */
        .btn-elite {
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
            overflow: hidden;
            border: 1px solid transparent;
        }

        .btn-elite:active {
            background-color: var(--accent-gold) !important;
            color: var(--bg-deep) !important;
            transform: scale(0.98);
        }

        /* Анимация дисплея */
        @keyframes fadeSlideUp {
            from { opacity: 0; transform: translateY(10px); filter: blur(4px); }
            to { opacity: 1; transform: translateY(0); filter: blur(0); }
        }

        .display-anim {
            animation: fadeSlideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        /* Сетка калькулятора */
        .calc-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background-color: var(--border-muted);
            border: 1px solid var(--border-muted);
        }

        @media (min-width: 768px) {
            .calc-grid { grid-template-columns: repeat(6, 1fr); }
            .pc-only { display: block; }
        }

        /* Скрытые элементы на разных платформах */
        @media (max-width: 767px) { .pc-only { display: none; } }

        /* Вкладки */
        .tab-btn {
            position: relative;
            transition: color 0.3s ease;
        }
        .tab-btn.active { color: var(--accent-gold); }
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 1px;
            background-color: var(--accent-gold);
        }

        #graphCanvas {
            background-color: #000;
            cursor: crosshair;
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col overflow-hidden no-select">

    <!-- Header Navigation -->
    <header class="h-14 flex items-center justify-between px-8 bg-black border-b border-[#111] shrink-0">
        <div class="flex space-x-10 text-[10px] tracking-[0.3em] font-light">
            <button onclick="switchTab('calc')" id="tab-calc" class="tab-btn active py-4">CALCULATOR</button>
            <button onclick="switchTab('graph')" id="tab-graph" class="tab-btn py-4 text-white/30 hover:text-white">VISUALIZER</button>
        </div>
        <div class="text-[9px] text-white/20 tracking-[0.5em] hidden sm:block">EST. 2025 / PRECISION ENGINE</div>
    </header>

    <main class="flex-1 relative">
        
        <!-- CALC VIEW -->
        <div id="view-calc" class="absolute inset-0 flex flex-col md:flex-row transition-all duration-700 ease-in-out">
            
            <div class="flex-1 flex flex-col h-full bg-black">
                <!-- Display Area -->
                <div class="h-1/3 md:h-[30%] flex flex-col justify-end p-10 border-b border-[#111]">
                    <div id="history-preview" class="text-right text-white/20 text-[10px] tracking-widest mb-4 h-4 font-extralight uppercase"></div>
                    <div id="display-container" class="w-full text-right">
                        <span id="display-val" class="text-5xl md:text-7xl font-extralight text-white tracking-tighter inline-block display-anim">0</span>
                    </div>
                </div>

                <!-- Keyboard -->
                <div class="flex-1 calc-grid">
                    <!-- Row 1 -->
                    <button class="btn-elite bg-black text-[#666] text-xs pc-only" onclick="inputFunc('sin')">SIN</button>
                    <button class="btn-elite bg-black text-[#666] text-xs pc-only" onclick="inputFunc('cos')">COS</button>
                    <button class="btn-elite bg-black text-white/40 text-xs" onclick="clearDisplay()">CLEAR</button>
                    <button class="btn-elite bg-black text-white/40 text-xs" onclick="backspace()">DEL</button>
                    <button class="btn-elite bg-black text-white/60 text-lg" onclick="inputOper('%')">%</button>
                    <button class="btn-elite bg-black text-[var(--accent-gold)] text-xl" onclick="inputOper('/')">÷</button>

                    <!-- Row 2 -->
                    <button class="btn-elite bg-black text-[#666] text-xs pc-only" onclick="inputFunc('tan')">TAN</button>
                    <button class="btn-elite bg-black text-[#666] text-xs pc-only" onclick="inputFunc('log')">LOG</button>
                    <button class="btn-elite bg-black text-white text-xl font-light" onclick="inputDigit('7')">7</button>
                    <button class="btn-elite bg-black text-white text-xl font-light" onclick="inputDigit('8')">8</button>
                    <button class="btn-elite bg-black text-white text-xl font-light" onclick="inputDigit('9')">9</button>
                    <button class="btn-elite bg-black text-[var(--accent-gold)] text-xl" onclick="inputOper('*')">×</button>

                    <!-- Row 3 -->
                    <button class="btn-elite bg-black text-[#666] text-xs pc-only" onclick="inputToken('(')">(</button>
                    <button class="btn-elite bg-black text-[#666] text-xs pc-only" onclick="inputToken(')')">)</button>
                    <button class="btn-elite bg-black text-white text-xl font-light" onclick="inputDigit('4')">4</button>
                    <button class="btn-elite bg-black text-white text-xl font-light" onclick="inputDigit('5')">5</button>
                    <button class="btn-elite bg-black text-white text-xl font-light" onclick="inputDigit('6')">6</button>
                    <button class="btn-elite bg-black text-[var(--accent-gold)] text-xl" onclick="inputOper('-')">−</button>

                    <!-- Row 4 -->
                    <button class="btn-elite bg-black text-[#666] text-xs pc-only" onclick="inputFunc('sqrt')">SQRT</button>
                    <button class="btn-elite bg-black text-[#666] text-xs pc-only" onclick="inputOper('^')">POW</button>
                    <button class="btn-elite bg-black text-white text-xl font-light" onclick="inputDigit('1')">1</button>
                    <button class="btn-elite bg-black text-white text-xl font-light" onclick="inputDigit('2')">2</button>
                    <button class="btn-elite bg-black text-white text-xl font-light" onclick="inputDigit('3')">3</button>
                    <button class="btn-elite bg-black text-[var(--accent-gold)] text-xl" onclick="inputOper('+')">+</button>

                    <!-- Row 5 -->
                    <button class="btn-elite bg-black text-[#666] text-xs pc-only" onclick="inputConst('PI')">PI</button>
                    <button class="btn-elite bg-black text-[#666] text-xs pc-only" onclick="inputConst('E')">E</button>
                    <button class="btn-elite bg-black text-white text-xl font-light col-span-2 md:col-span-1" onclick="inputDigit('0')">0</button>
                    <button class="btn-elite bg-black text-white text-xl font-light" onclick="inputDigit('.')">.</button>
                    <button class="btn-elite bg-[var(--accent-gold)] text-black text-xl font-medium md:col-span-1" onclick="calculate()">=</button>
                </div>
            </div>

            <!-- History Sidebar (Elite Minimal) -->
            <aside class="hidden md:flex w-96 bg-[#050505] border-l border-[#111] flex-col">
                <div class="p-8 flex justify-between items-center">
                    <span class="text-[9px] tracking-[0.4em] text-white/20">LOGS</span>
                    <button onclick="clearHistory()" class="text-[9px] tracking-[0.2em] text-red-900/50 hover:text-red-500 transition-colors uppercase">Clear</button>
                </div>
                <div id="history-list" class="flex-1 overflow-y-auto px-8 pb-8 space-y-6">
                    <div class="text-[10px] text-white/10 text-center mt-20 italic">No activity recorded</div>
                </div>
            </aside>
        </div>

        <!-- VISUALIZER VIEW -->
        <div id="view-graph" class="absolute inset-0 bg-black translate-x-full transition-all duration-700 ease-in-out flex flex-col">
            <div class="h-20 bg-black border-b border-[#111] flex items-center px-10 space-x-6 shrink-0">
                <span class="text-[var(--accent-gold)] text-xs font-light italic">f(x) =</span>
                <input type="text" id="func-input" value="sin(x) * cos(x/2)" 
                       class="flex-1 bg-transparent border-b border-[#222] text-white focus:border-[var(--accent-gold)] outline-none px-2 py-2 text-sm transition-colors font-light"
                       placeholder="Enter function...">
                <button onclick="drawGraph()" class="text-[9px] tracking-[0.3em] border border-white/10 px-6 py-2 hover:bg-white hover:text-black transition-all">VISUALIZE</button>
            </div>
            
            <div class="flex-1 relative overflow-hidden">
                <canvas id="graphCanvas"></canvas>
                <div class="absolute bottom-10 right-10 flex flex-col space-y-4">
                    <button onclick="zoom(0.8)" class="w-12 h-12 border border-white/5 bg-black/50 backdrop-blur-md text-white/50 hover:text-white hover:border-white/20 transition-all">+</button>
                    <button onclick="zoom(1.2)" class="w-12 h-12 border border-white/5 bg-black/50 backdrop-blur-md text-white/50 hover:text-white hover:border-white/20 transition-all">-</button>
                    <button onclick="resetView()" class="w-12 h-12 border border-white/5 bg-black/50 backdrop-blur-md text-[8px] text-white/50 hover:text-white hover:border-white/20 transition-all tracking-tighter">RESET</button>
                </div>
            </div>
        </div>

    </main>

<script>
    // --- State Management ---
    let expr = "";
    let shouldReset = false;
    const displayVal = document.getElementById('display-val');
    const historyPreview = document.getElementById('history-preview');
    const historyList = document.getElementById('history-list');

    function updateDisplay(withAnim = true) {
        if (withAnim) {
            displayVal.classList.remove('display-anim');
            void displayVal.offsetWidth;
            displayVal.classList.add('display-anim');
        }
        displayVal.textContent = expr || "0";
    }

    function switchTab(tab) {
        const calcView = document.getElementById('view-calc');
        const graphView = document.getElementById('view-graph');
        const tabCalc = document.getElementById('tab-calc');
        const tabGraph = document.getElementById('tab-graph');

        if (tab === 'calc') {
            calcView.style.transform = 'translateX(0)';
            graphView.style.transform = 'translateX(100%)';
            tabCalc.classList.add('active');
            tabGraph.classList.remove('active');
        } else {
            calcView.style.transform = 'translateX(-100%)';
            graphView.style.transform = 'translateX(0)';
            tabGraph.classList.add('active');
            tabCalc.classList.remove('active');
            setTimeout(resizeCanvas, 50);
        }
    }

    // --- Calculator Logic ---
    function inputDigit(d) {
        if (shouldReset) { expr = ""; shouldReset = false; }
        expr += d;
        updateDisplay();
    }

    function inputOper(op) {
        shouldReset = false;
        expr += op;
        updateDisplay();
    }

    function inputToken(t) {
        expr += t;
        updateDisplay();
    }

    function inputConst(c) {
        shouldReset = false;
        expr += (c === 'PI' ? "Math.PI" : "Math.E");
        updateDisplay();
    }

    function inputFunc(f) {
        expr += f + "(";
        updateDisplay();
    }

    function clearDisplay() {
        expr = "";
        historyPreview.textContent = "";
        updateDisplay();
    }

    function backspace() {
        expr = expr.slice(0, -1);
        updateDisplay(false);
    }

    function calculate() {
        try {
            let evalExpr = expr
                .replace(/sin/g, "Math.sin")
                .replace(/cos/g, "Math.cos")
                .replace(/tan/g, "Math.tan")
                .replace(/log/g, "Math.log10")
                .replace(/sqrt/g, "Math.sqrt")
                .replace(/\^/g, "**");

            const result = eval(evalExpr);
            if (!isFinite(result)) throw new Error("Infinity");

            let resStr = parseFloat(result.toPrecision(12)).toString();
            addToHistory(expr, resStr);
            historyPreview.textContent = expr + " =";
            expr = resStr;
            shouldReset = true;
            updateDisplay();
        } catch (e) {
            displayVal.textContent = "ERR_INVALID";
            shouldReset = true;
        }
    }

    function addToHistory(formula, res) {
        const item = document.createElement('div');
        item.className = "group cursor-pointer border-b border-white/[0.03] pb-4 transition-all hover:border-[var(--accent-gold)]";
        item.onclick = () => { expr = res; shouldReset = false; updateDisplay(); };
        item.innerHTML = `
            <div class="text-[8px] text-white/20 tracking-widest mb-1 group-hover:text-[var(--accent-gold)] transition-colors uppercase">${formula}</div>
            <div class="text-right text-white/80 font-light text-sm tracking-tighter">${res}</div>
        `;
        if (historyList.children[0]?.textContent === "No activity recorded") historyList.innerHTML = "";
        historyList.prepend(item);
    }

    function clearHistory() {
        historyList.innerHTML = '<div class="text-[10px] text-white/10 text-center mt-20 italic">No activity recorded</div>';
    }

    // --- Visualizer Logic (Canvas) ---
    const canvas = document.getElementById('graphCanvas');
    const ctx = canvas.getContext('2d');
    let scale = 60;
    let offsetX = 0, offsetY = 0;
    let isDragging = false, lastX, lastY;

    function resizeCanvas() {
        canvas.width = canvas.parentElement.clientWidth;
        canvas.height = canvas.parentElement.clientHeight;
        drawGraph();
    }

    function zoom(f) { scale *= f; drawGraph(); }
    function resetView() { scale = 60; offsetX = 0; offsetY = 0; drawGraph(); }

    canvas.addEventListener('mousedown', e => { isDragging = true; lastX = e.clientX; lastY = e.clientY; });
    window.addEventListener('mouseup', () => isDragging = false);
    window.addEventListener('mousemove', e => {
        if (!isDragging) return;
        offsetX += e.clientX - lastX;
        offsetY += e.clientY - lastY;
        lastX = e.clientX; lastY = e.clientY;
        drawGraph();
    });

    function drawGraph() {
        const w = canvas.width, h = canvas.height;
        const cx = w / 2 + offsetX, cy = h / 2 + offsetY;

        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, w, h);

        // Grid Lines
        ctx.beginPath();
        ctx.strokeStyle = "#111";
        ctx.lineWidth = 1;
        for (let x = (cx % scale) - scale; x < w; x += scale) { ctx.moveTo(x, 0); ctx.lineTo(x, h); }
        for (let y = (cy % scale) - scale; y < h; y += scale) { ctx.moveTo(0, y); ctx.lineTo(w, y); }
        ctx.stroke();

        // Axes
        ctx.beginPath();
        ctx.strokeStyle = "#222";
        ctx.lineWidth = 2;
        ctx.moveTo(0, cy); ctx.lineTo(w, cy);
        ctx.moveTo(cx, 0); ctx.lineTo(cx, h);
        ctx.stroke();

        // Curve
        const funcStr = document.getElementById('func-input').value;
        if (!funcStr) return;

        ctx.beginPath();
        ctx.strokeStyle = "#c5a059";
        ctx.lineWidth = 2;
        ctx.lineJoin = "round";

        let started = false;
        for (let px = 0; px < w; px++) {
            let x = (px - cx) / scale;
            try {
                let safe = funcStr.toLowerCase()
                    .replace(/sin/g, "Math.sin").replace(/cos/g, "Math.cos")
                    .replace(/tan/g, "Math.tan").replace(/sqrt/g, "Math.sqrt")
                    .replace(/\^/g, "**").replace(/pi/g, "Math.PI").replace(/e/g, "Math.E");
                let y = eval(safe.replace(/x/g, `(${x})`));
                let py = cy - (y * scale);
                if (!started) { ctx.moveTo(px, py); started = true; }
                else if (Math.abs(py) < h * 2) ctx.lineTo(px, py);
            } catch(e) {}
        }
        ctx.stroke();
    }

    window.addEventListener('resize', resizeCanvas);
</script>
</body>
</html>
