<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>MULTICOLOR SQUARE - Professional Pixel Art Editor</title>
<meta name="description" content="–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø–∏–∫—Å–µ–ª—å–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫–∏ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
--primary:#667eea;
--primary-dark:#5568d3;
--bg:#0f0f23;
--surface:#1a1a2e;
--surface-light:#232340;
--border:#2d2d4a;
--text:#e4e4f0;
--text-dim:#a0a0b8;
--accent:#ff6b9d;
--success:#4ade80;
--warning:#fbbf24;
--grid-light:#2a2a40;
--shadow:0 4px 24px rgba(0,0,0,.4);
--shadow-sm:0 2px 8px rgba(0,0,0,.3);
}
body{
font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;
background:var(--bg);
color:var(--text);
overflow:hidden;
height:100vh;
}
header{
background:var(--surface);
border-bottom:2px solid var(--primary);
padding:1rem 1.5rem;
display:flex;
align-items:center;
justify-content:space-between;
box-shadow:var(--shadow-sm);
}
.logo{
font-size:1.5rem;
font-weight:700;
background:linear-gradient(135deg,var(--primary),var(--accent));
-webkit-background-clip:text;
background-clip:text;
-webkit-text-fill-color:transparent;
letter-spacing:-.5px;
}
.header-controls{
display:flex;
gap:.75rem;
align-items:center;
}
.btn{
padding:.5rem 1rem;
background:var(--surface-light);
border:1px solid var(--border);
color:var(--text);
border-radius:6px;
cursor:pointer;
font-size:.875rem;
font-weight:500;
transition:all .2s;
}
.btn:hover{
background:var(--primary);
border-color:var(--primary);
transform:translateY(-1px);
}
.btn:active{
transform:translateY(0);
}
.btn-primary{
background:var(--primary);
border-color:var(--primary);
}
.btn-primary:hover{
background:var(--primary-dark);
}
main{
display:flex;
height:calc(100vh - 66px);
}
.toolbar{
background:var(--surface);
border-right:1px solid var(--border);
padding:1rem;
width:240px;
overflow-y:auto;
}
.tool-section{
margin-bottom:1.5rem;
}
.tool-section h3{
font-size:.75rem;
text-transform:uppercase;
letter-spacing:.5px;
color:var(--text-dim);
margin-bottom:.75rem;
}
.tool-grid{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:.5rem;
}
.tool-btn{
aspect-ratio:1;
background:var(--surface-light);
border:2px solid var(--border);
border-radius:6px;
cursor:pointer;
display:flex;
align-items:center;
justify-content:center;
font-size:1.25rem;
transition:all .2s;
}
.tool-btn:hover{
border-color:var(--primary);
transform:scale(1.05);
}
.tool-btn.active{
background:var(--primary);
border-color:var(--primary);
}
.color-palette{
display:grid;
grid-template-columns:repeat(8,1fr);
gap:4px;
margin-bottom:.75rem;
}
.color-swatch{
aspect-ratio:1;
border:2px solid var(--border);
border-radius:4px;
cursor:pointer;
transition:all .15s;
}
.color-swatch:hover{
transform:scale(1.15);
border-color:var(--text);
}
.color-swatch.active{
border-color:var(--accent);
border-width:3px;
}
.color-inputs{
display:grid;
grid-template-columns:1fr 1fr;
gap:.5rem;
margin-top:.75rem;
}
.color-input-wrapper{
display:flex;
align-items:center;
gap:.5rem;
background:var(--surface-light);
border:1px solid var(--border);
border-radius:4px;
padding:.25rem .5rem;
}
.color-input-wrapper input[type="color"]{
width:32px;
height:32px;
border:none;
background:transparent;
cursor:pointer;
}
.color-input-wrapper input[type="text"]{
flex:1;
background:transparent;
border:none;
color:var(--text);
font-size:.75rem;
text-transform:uppercase;
width:100%;
}
input[type="range"]{
width:100%;
height:6px;
background:var(--border);
border-radius:3px;
outline:none;
-webkit-appearance:none;
}
input[type="range"]::-webkit-slider-thumb{
-webkit-appearance:none;
width:16px;
height:16px;
background:var(--primary);
border-radius:50%;
cursor:pointer;
}
input[type="range"]::-moz-range-thumb{
width:16px;
height:16px;
background:var(--primary);
border-radius:50%;
cursor:pointer;
border:none;
}
.slider-label{
display:flex;
justify-content:space-between;
font-size:.75rem;
color:var(--text-dim);
margin-bottom:.25rem;
}
.canvas-wrapper{
flex:1;
display:flex;
align-items:center;
justify-content:center;
background:linear-gradient(135deg,#0f0f23 0%,#1a1a2e 100%);
padding:2rem;
overflow:auto;
position:relative;
}
.canvas-container{
position:relative;
box-shadow:var(--shadow);
border-radius:8px;
overflow:hidden;
}
#pixelCanvas{
image-rendering:pixelated;
image-rendering:crisp-edges;
border:2px solid var(--border);
cursor:crosshair;
}
.sidebar{
background:var(--surface);
border-left:1px solid var(--border);
width:280px;
padding:1rem;
overflow-y:auto;
}
.layer{
background:var(--surface-light);
border:1px solid var(--border);
border-radius:6px;
padding:.75rem;
margin-bottom:.5rem;
display:flex;
align-items:center;
gap:.75rem;
cursor:pointer;
transition:all .2s;
}
.layer:hover{
border-color:var(--primary);
}
.layer.active{
background:var(--primary);
}
.layer-preview{
width:40px;
height:40px;
border:1px solid var(--border);
border-radius:4px;
background-image:linear-gradient(45deg,#333 25%,transparent 25%),linear-gradient(-45deg,#333 25%,transparent 25%),linear-gradient(45deg,transparent 75%,#333 75%),linear-gradient(-45deg,transparent 75%,#333 75%);
background-size:20px 20px;
background-position:0 0,0 10px,10px -10px,-10px 0;
}
.layer-info{
flex:1;
}
.layer-name{
font-size:.875rem;
font-weight:500;
}
.layer-size{
font-size:.75rem;
color:var(--text-dim);
}
.toast{
position:fixed;
bottom:2rem;
right:2rem;
background:var(--surface);
border:1px solid var(--primary);
border-radius:8px;
padding:1rem 1.5rem;
box-shadow:var(--shadow);
transform:translateY(200%);
transition:transform .3s cubic-bezier(.68,-.55,.265,1.55);
z-index:1000;
}
.toast.show{
transform:translateY(0);
}
.modal{
position:fixed;
inset:0;
background:rgba(0,0,0,.8);
display:none;
align-items:center;
justify-content:center;
z-index:2000;
backdrop-filter:blur(4px);
}
.modal.active{
display:flex;
}
.modal-content{
background:var(--surface);
border:1px solid var(--border);
border-radius:12px;
padding:2rem;
max-width:500px;
width:90%;
box-shadow:var(--shadow);
}
.modal-header{
font-size:1.25rem;
font-weight:600;
margin-bottom:1.5rem;
}
.modal-body{
margin-bottom:1.5rem;
}
.modal-footer{
display:flex;
gap:.75rem;
justify-content:flex-end;
}
.input-group{
margin-bottom:1rem;
}
.input-group label{
display:block;
font-size:.875rem;
color:var(--text-dim);
margin-bottom:.5rem;
}
.input-group input,.input-group select{
width:100%;
background:var(--surface-light);
border:1px solid var(--border);
color:var(--text);
padding:.5rem;
border-radius:6px;
font-size:.875rem;
}
@media(max-width:1200px){
.sidebar{width:240px}
.toolbar{width:200px}
}
@media(max-width:900px){
main{flex-direction:column}
.toolbar,.sidebar{width:100%;border:none;border-bottom:1px solid var(--border);max-height:200px}
.canvas-wrapper{padding:1rem}
}
@media(prefers-reduced-motion:reduce){
*{animation:none!important;transition:none!important}
}
</style>
</head>
<body>
<header>
<div class="logo">MULTICOLOR SQUARE</div>
<div class="header-controls">
<button class="btn" id="newBtn" aria-label="–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç">–ù–æ–≤—ã–π</button>
<button class="btn" id="saveBtn" aria-label="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
<button class="btn" id="exportBtn" aria-label="–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">–≠–∫—Å–ø–æ—Ä—Ç</button>
<button class="btn" id="importBtn" aria-label="–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">–ò–º–ø–æ—Ä—Ç</button>
<input type="file" id="fileInput" accept="image/*" style="display:none">
</div>
</header>
<main>
<aside class="toolbar">
<section class="tool-section">
<h3>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h3>
<div class="tool-grid">
<button class="tool-btn active" data-tool="brush" aria-label="–ö–∏—Å—Ç—å" title="–ö–∏—Å—Ç—å">üñåÔ∏è</button>
<button class="tool-btn" data-tool="eraser" aria-label="–õ–∞—Å—Ç–∏–∫" title="–õ–∞—Å—Ç–∏–∫">üßπ</button>
<button class="tool-btn" data-tool="fill" aria-label="–ó–∞–ª–∏–≤–∫–∞" title="–ó–∞–ª–∏–≤–∫–∞">ü™£</button>
<button class="tool-btn" data-tool="picker" aria-label="–ü–∏–ø–µ—Ç–∫–∞" title="–ü–∏–ø–µ—Ç–∫–∞">üíâ</button>
<button class="tool-btn" data-tool="line" aria-label="–õ–∏–Ω–∏—è" title="–õ–∏–Ω–∏—è">üìè</button>
<button class="tool-btn" data-tool="rect" aria-label="–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫" title="–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫">‚ñ≠</button>
<button class="tool-btn" data-tool="circle" aria-label="–ö—Ä—É–≥" title="–ö—Ä—É–≥">‚óØ</button>
<button class="tool-btn" data-tool="select" aria-label="–í—ã–¥–µ–ª–µ–Ω–∏–µ" title="–í—ã–¥–µ–ª–µ–Ω–∏–µ">‚¨ö</button>
<button class="tool-btn" data-tool="move" aria-label="–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ" title="–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ">‚ú•</button>
</div>
</section>
<section class="tool-section">
<h3>–¶–≤–µ—Ç–∞</h3>
<div class="color-palette" id="colorPalette"></div>
<div class="color-inputs">
<div class="color-input-wrapper">
<input type="color" id="primaryColor" value="#667eea">
<input type="text" id="primaryColorHex" value="#667eea" maxlength="7">
</div>
<div class="color-input-wrapper">
<input type="color" id="secondaryColor" value="#ff6b9d">
<input type="text" id="secondaryColorHex" value="#ff6b9d" maxlength="7">
</div>
</div>
</section>
<section class="tool-section">
<h3>–†–∞–∑–º–µ—Ä –∫–∏—Å—Ç–∏</h3>
<div class="slider-label"><span>–†–∞–∑–º–µ—Ä</span><span id="brushSizeValue">1</span></div>
<input type="range" id="brushSize" min="1" max="10" value="1">
</section>
<section class="tool-section">
<h3>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å</h3>
<div class="slider-label"><span>Opacity</span><span id="opacityValue">100%</span></div>
<input type="range" id="opacity" min="0" max="100" value="100">
</section>
<section class="tool-section">
<h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</h3>
<button class="btn" id="clearBtn" style="width:100%;margin-bottom:.5rem">–û—á–∏—Å—Ç–∏—Ç—å —Ö–æ–ª—Å—Ç</button>
<button class="btn" id="undoBtn" style="width:100%;margin-bottom:.5rem">–û—Ç–º–µ–Ω–∏—Ç—å</button>
<button class="btn" id="redoBtn" style="width:100%">–í–µ—Ä–Ω—É—Ç—å</button>
</section>
</aside>
<section class="canvas-wrapper">
<div class="canvas-container">
<canvas id="pixelCanvas" width="800" height="600"></canvas>
</div>
</section>
<aside class="sidebar">
<section class="tool-section">
<h3>–°–ª–æ–∏</h3>
<button class="btn" id="addLayerBtn" style="width:100%;margin-bottom:.75rem">+ –ù–æ–≤—ã–π —Å–ª–æ–π</button>
<div id="layersList"></div>
</section>
<section class="tool-section">
<h3>–§–∏–ª—å—Ç—Ä—ã</h3>
<button class="btn" id="invertBtn" style="width:100%;margin-bottom:.5rem">–ò–Ω–≤–µ—Ä—Å–∏—è</button>
<button class="btn" id="grayscaleBtn" style="width:100%;margin-bottom:.5rem">–ß—ë—Ä–Ω–æ-–±–µ–ª–æ–µ</button>
<button class="btn" id="blurBtn" style="width:100%;margin-bottom:.5rem">–†–∞–∑–º—ã—Ç–∏–µ</button>
<button class="btn" id="pixelateBtn" style="width:100%">–ü–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏—è</button>
</section>
</section>
</main>
<div class="toast" id="toast"></div>
<div class="modal" id="newModal">
<div class="modal-content">
<h2 class="modal-header">–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</h2>
<div class="modal-body">
<div class="input-group">
<label for="canvasWidth">–®–∏—Ä–∏–Ω–∞ (px)</label>
<input type="number" id="canvasWidth" value="800" min="1" max="4096">
</div>
<div class="input-group">
<label for="canvasHeight">–í—ã—Å–æ—Ç–∞ (px)</label>
<input type="number" id="canvasHeight" value="600" min="1" max="4096">
</div>
</div>
<div class="modal-footer">
<button class="btn" id="cancelNewBtn">–û—Ç–º–µ–Ω–∞</button>
<button class="btn btn-primary" id="confirmNewBtn">–°–æ–∑–¥–∞—Ç—å</button>
</div>
</div>
</div>
<script>
const canvas=document.getElementById('pixelCanvas');
const ctx=canvas.getContext('2d',{willReadFrequently:true});
const toast=document.getElementById('toast');
const newModal=document.getElementById('newModal');
const colorPalette=document.getElementById('colorPalette');
const primaryColor=document.getElementById('primaryColor');
const secondaryColor=document.getElementById('secondaryColor');
const primaryColorHex=document.getElementById('primaryColorHex');
const secondaryColorHex=document.getElementById('secondaryColorHex');
const brushSizeSlider=document.getElementById('brushSize');
const brushSizeValue=document.getElementById('brushSizeValue');
const opacitySlider=document.getElementById('opacity');
const opacityValue=document.getElementById('opacityValue');
const layersList=document.getElementById('layersList');
const fileInput=document.getElementById('fileInput');
const defaultPalette=['#000000','#FFFFFF','#667eea','#ff6b9d','#4ade80','#fbbf24','#f87171','#a78bfa','#60a5fa','#34d399','#fbbf24','#fb923c','#ec4899','#8b5cf6','#6366f1','#3b82f6','#14b8a6','#10b981','#84cc16','#eab308','#f97316','#ef4444','#dc2626','#991b1b','#7f1d1d','#78350f','#451a03','#1e3a8a','#1e40af','#1e293b','#334155','#475569'];
let currentTool='brush';
let currentColor='#667eea';
let brushSize=1;
let opacity=1;
let isDrawing=false;
let lastX=0;
let lastY=0;
let history=[];
let historyStep=-1;
let layers=[{id:0,name:'–°–ª–æ–π 1',visible:true,canvas:null}];
let currentLayerIndex=0;
function init(){
ctx.fillStyle='#ffffff';
ctx.fillRect(0,0,canvas.width,canvas.height);
saveState();
renderPalette();
updateLayersList();
setupEventListeners();
}
function renderPalette(){
colorPalette.innerHTML='';
defaultPalette.forEach(color=>{
const swatch=document.createElement('div');
swatch.className='color-swatch';
swatch.style.backgroundColor=color;
swatch.addEventListener('click',()=>{
primaryColor.value=color;
primaryColorHex.value=color;
currentColor=color;
updateActiveColor();
});
colorPalette.appendChild(swatch);
});
}
function updateActiveColor(){
document.querySelectorAll('.color-swatch').forEach(s=>{
s.classList.toggle('active',s.style.backgroundColor===rgbToHex(currentColor));
});
}
function rgbToHex(color){
if(color.startsWith('#'))return color;
const rgb=color.match(/\d+/g);
return'#'+((1<<24)+(+rgb[0]<<16)+(+rgb[1]<<8)+ +rgb[2]).toString(16).slice(1);
}
function setupEventListeners(){
canvas.addEventListener('mousedown',startDrawing);
canvas.addEventListener('mousemove',draw);
canvas.addEventListener('mouseup',stopDrawing);
canvas.addEventListener('mouseout',stopDrawing);
canvas.addEventListener('touchstart',e=>{e.preventDefault();startDrawing(e.touches[0])});
canvas.addEventListener('touchmove',e=>{e.preventDefault();draw(e.touches[0])});
canvas.addEventListener('touchend',stopDrawing);
document.querySelectorAll('.tool-btn').forEach(btn=>{
btn.addEventListener('click',()=>{
document.querySelectorAll('.tool-btn').forEach(b=>b.classList.remove('active'));
btn.classList.add('active');
currentTool=btn.dataset.tool;
});
});
primaryColor.addEventListener('input',e=>{
currentColor=e.target.value;
primaryColorHex.value=e.target.value;
updateActiveColor();
});
primaryColorHex.addEventListener('input',e=>{
if(/^#[0-9A-F]{6}$/i.test(e.target.value)){
currentColor=e.target.value;
primaryColor.value=e.target.value;
updateActiveColor();
}
});
brushSizeSlider.addEventListener('input',e=>{
brushSize=parseInt(e.target.value);
brushSizeValue.textContent=brushSize;
});
opacitySlider.addEventListener('input',e=>{
opacity=parseInt(e.target.value)/100;
opacityValue.textContent=e.target.value+'%';
});
document.getElementById('newBtn').addEventListener('click',()=>newModal.classList.add('active'));
document.getElementById('cancelNewBtn').addEventListener('click',()=>newModal.classList.remove('active'));
document.getElementById('confirmNewBtn').addEventListener('click',createNewCanvas);
document.getElementById('saveBtn').addEventListener('click',saveProject);
document.getElementById('exportBtn').addEventListener('click',exportImage);
document.getElementById('importBtn').addEventListener('click',()=>fileInput.click());
fileInput.addEventListener('change',importImage);
document.getElementById('clearBtn').addEventListener('click',clearCanvas);
document.getElementById('undoBtn').addEventListener('click',undo);
document.getElementById('redoBtn').addEventListener('click',redo);
document.getElementById('addLayerBtn').addEventListener('click',addLayer);
document.getElementById('invertBtn').addEventListener('click',()=>applyFilter('invert'));
document.getElementById('grayscaleBtn').addEventListener('click',()=>applyFilter('grayscale'));
document.getElementById('blurBtn').addEventListener('click',()=>applyFilter('blur'));
document.getElementById('pixelateBtn').addEventListener('click',()=>applyFilter('pixelate'));
document.addEventListener('keydown',e=>{
if(e.ctrlKey||e.metaKey){
if(e.key==='z'){e.preventDefault();undo()}
if(e.key==='y'){e.preventDefault();redo()}
if(e.key==='s'){e.preventDefault();saveProject()}
}
});
}
function startDrawing(e){
isDrawing=true;
const rect=canvas.getBoundingClientRect();
lastX=(e.clientX-rect.left)*(canvas.width/rect.width);
lastY=(e.clientY-rect.top)*(canvas.height/rect.height);
if(currentTool==='brush')drawPixel(lastX,lastY);
if(currentTool==='fill')floodFill(Math.floor(lastX),Math.floor(lastY));
if(currentTool==='picker')pickColor(lastX,lastY);
}
function draw(e){
if(!isDrawing)return;
const rect=canvas.getBoundingClientRect();
const x=(e.clientX-rect.left)*(canvas.width/rect.width);
const y=(e.clientY-rect.top)*(canvas.height/rect.height);
if(currentTool==='brush'){
drawLine(lastX,lastY,x,y);
lastX=x;
lastY=y;
}else if(currentTool==='eraser'){
ctx.globalCompositeOperation='destination-out';
drawPixel(x,y);
ctx.globalCompositeOperation='source-over';
}
}
function stopDrawing(){
if(isDrawing){
isDrawing=false;
saveState();
}
}
function drawPixel(x,y){
ctx.globalAlpha=opacity;
ctx.fillStyle=currentColor;
const size=brushSize;
ctx.fillRect(Math.floor(x)-Math.floor(size/2),Math.floor(y)-Math.floor(size/2),size,size);
ctx.globalAlpha=1;
}
function drawLine(x1,y1,x2,y2){
const dist=Math.hypot(x2-x1,y2-y1);
const steps=Math.max(1,Math.ceil(dist));
for(let i=0;i<=steps;i++){
const t=i/steps;
const x=x1+(x2-x1)*t;
const y=y1+(y2-y1)*t;
drawPixel(x,y);
}
}
function floodFill(x,y){
const imageData=ctx.getImageData(0,0,canvas.width,canvas.height);
const target=getPixelColor(imageData,x,y);
const fill=hexToRgb(currentColor);
if(colorsMatch(target,fill))return;
const stack=[[x,y]];
while(stack.length){
const[px,py]=stack.pop();
if(px<0||px>=canvas.width||py<0||py>=canvas.height)continue;
const current=getPixelColor(imageData,px,py);
if(!colorsMatch(current,target))continue;
setPixelColor(imageData,px,py,fill);
stack.push([px+1,py],[px-1,py],[px,py+1],[px,py-1]);
}
ctx.putImageData(imageData,0,0);
saveState();
}
function getPixelColor(imageData,x,y){
const i=(y*imageData.width+x)*4;
return[imageData.data[i],imageData.data[i+1],imageData.data[i+2],imageData.data[i+3]];
}
function setPixelColor(imageData,x,y,color){
const i=(y*imageData.width+x)*4;
imageData.data[i]=color[0];
imageData.data[i+1]=color[1];
imageData.data[i+2]=color[2];
imageData.data[i+3]=255;
}
function colorsMatch(a,b){
return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3];
}
function hexToRgb(hex){
const r=parseInt(hex.slice(1,3),16);
const g=parseInt(hex.slice(3,5),16);
const b=parseInt(hex.slice(5,7),16);
return[r,g,b,255];
}
function pickColor(x,y){
const imageData=ctx.getImageData(Math.floor(x),Math.floor(y),1,1);
const[r,g,b]=imageData.data;
const hex='#'+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1);
currentColor=hex;
primaryColor.value=hex;
primaryColorHex.value=hex;
updateActiveColor();
showToast('–¶–≤–µ—Ç –≤—ã–±—Ä–∞–Ω: '+hex);
}
function saveState(){
if(historyStep<history.length-1)history=history.slice(0,historyStep+1);
history.push(canvas.toDataURL());
historyStep++;
if(history.length>50){history.shift();historyStep--}
}
function undo(){
if(historyStep>0){
historyStep--;
const img=new Image();
img.onload=()=>ctx.drawImage(img,0,0);
img.src=history[historyStep];
showToast('–û—Ç–º–µ–Ω–µ–Ω–æ');
}
}
function redo(){
if(historyStep<history.length-1){
historyStep++;
const img=new Image();
img.onload=()=>ctx.drawImage(img,0,0);
img.src=history[historyStep];
showToast('–í–æ–∑–≤—Ä–∞—â–µ–Ω–æ');
}
}
function clearCanvas(){
if(confirm('–û—á–∏—Å—Ç–∏—Ç—å —Ö–æ–ª—Å—Ç?')){
ctx.fillStyle='#ffffff';
ctx.fillRect(0,0,canvas.width,canvas.height);
saveState();
showToast('–•–æ–ª—Å—Ç –æ—á–∏—â–µ–Ω');
}
}
function createNewCanvas(){
const w=parseInt(document.getElementById('canvasWidth').value);
const h=parseInt(document.getElementById('canvasHeight').value);
if(w>0&&h>0&&w<=4096&&h<=4096){
canvas.width=w;
canvas.height=h;
ctx.fillStyle='#ffffff';
ctx.fillRect(0,0,w,h);
history=[];
historyStep=-1;
saveState();
newModal.classList.remove('active');
showToast('–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω');
}
}
function saveProject(){
const data={
width:canvas.width,
height:canvas.height,
image:canvas.toDataURL(),
layers:layers
};
const blob=new Blob([JSON.stringify(data)],{type:'application/json'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;
a.download='multicolor-square-project.json';
a.click();
showToast('–ü—Ä–æ–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
}
function exportImage(){
const link=document.createElement('a');
link.download='multicolor-square-art.png';
link.href=canvas.toDataURL();
link.click();
showToast('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ');
}
function importImage(e){
const file=e.target.files[0];
if(!file)return;
const reader=new FileReader();
reader.onload=ev=>{
const img=new Image();
img.onload=()=>{
ctx.drawImage(img,0,0,canvas.width,canvas.height);
saveState();
showToast('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ');
};
img.src=ev.target.result;
};
reader.readAsDataURL(file);
}
function addLayer(){
const newLayer={
id:layers.length,
name:'–°–ª–æ–π '+(layers.length+1),
visible:true,
canvas:null
};
layers.push(newLayer);
updateLayersList();
showToast('–°–ª–æ–π –¥–æ–±–∞–≤–ª–µ–Ω');
}
function updateLayersList(){
layersList.innerHTML='';
layers.forEach((layer,index)=>{
const div=document.createElement('div');
div.className='layer'+(index===currentLayerIndex?' active':'');
div.innerHTML=`
<div class="layer-preview"></div>
<div class="layer-info">
<div class="layer-name">${layer.name}</div>
<div class="layer-size">${canvas.width}√ó${canvas.height}</div>
</div>
`;
div.addEventListener('click',()=>{
currentLayerIndex=index;
updateLayersList();
});
layersList.appendChild(div);
});
}
function applyFilter(type){
const imageData=ctx.getImageData(0,0,canvas.width,canvas.height);
const data=imageData.data;
if(type==='invert'){
for(let i=0;i<data.length;i+=4){
data[i]=255-data[i];
data[i+1]=255-data[i+1];
data[i+2]=255-data[i+2];
}
}else if(type==='grayscale'){
for(let i=0;i<data.length;i+=4){
const avg=(data[i]+data[i+1]+data[i+2])/3;
data[i]=data[i+1]=data[i+2]=avg;
}
}else if(type==='blur'){
ctx.filter='blur(2px)';
ctx.drawImage(canvas,0,0);
ctx.filter='none';
saveState();
showToast('–§–∏–ª—å—Ç—Ä –ø—Ä–∏–º–µ–Ω—ë–Ω');
return;
}else if(type==='pixelate'){
const factor=4;
const w=canvas.width/factor;
const h=canvas.height/factor;
ctx.drawImage(canvas,0,0,w,h);
ctx.drawImage(canvas,0,0,w,h,0,0,canvas.width,canvas.height);
saveState();
showToast('–§–∏–ª—å—Ç—Ä –ø—Ä–∏–º–µ–Ω—ë–Ω');
return;
}
ctx.putImageData(imageData,0,0);
saveState();
showToast('–§–∏–ª—å—Ç—Ä –ø—Ä–∏–º–µ–Ω—ë–Ω');
}
function showToast(message){
toast.textContent=message;
toast.classList.add('show');
setTimeout(()=>toast.classList.remove('show'),2500);
}
init();
</script>
</body>
</html>
